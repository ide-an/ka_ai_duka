<!doctype html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <title>花AI塚 AIスクリプト ドキュメント</title>
  </head>
  <body>

<h1>花AI塚 AIスクリプト ドキュメント</h1>


<h2>概要</h2>


<p>花AI塚のAIはLua5.1(<a href="http://www.lua.org/">http://www.lua.org/</a>, <a href="http://milkpot.sakura.ne.jp/lua/lua51_manual_ja.html">http://milkpot.sakua.ne.jp/lua/lua51_manual_ja.html</a>)で記述します。
花映塚の対戦が開始するとスクリプトがロードされ、以後対戦が終了するまで毎フレームmain関数が呼び出されます。

大戦終了後はスクリプトがアンロードされます。

</p>

<h2>Lua5.1標準ライブラリからの制限</h2>


<p>セキュリティ上の都合により、提供する標準ライブラリを制限しています。
</p>
<h3> 使用できないライブラリ</h3>


<p>以下の関数はAIスクリプト内で使用できません。
</p>
<ul>
<li>collectgarbage</li>
<li>getfenv </li>
<li>getmetatable </li>
<li>load</li>
<li>loadstring</li>
<li>print</li>
<li>rawequal</li>
<li>rawget</li>
<li>setfenv</li>
<li>setmetatable </li>
<li>module</li>
<li>require</li>
<li>package.*</li>
<li>string.dump</li>
<li>ioモジュールのうち
<ul>
<li>io.close</li>
<li>io.flush</li>
<li>io.input</li>
<li>io.lines</li>
<li>io.output</li>
<li>io.popen</li>
<li>io.read</li>
<li>io.tmpfile</li>
<li>io.write</li>
</ul></li>
<li>osモジュールのうち
<ul>
<li>os.execute</li>
<li>os.exit</li>
<li>os.getenv</li>
<li>os.remove</li>
<li>os.rename</li>
<li>os.setlocale</li>
<li>os.tmpname</li>
</ul></li>
<li>debug.*</li>
</ul>


<h3> 使用できるが、制限されているライブラリ</h3>


<p>以下の関数はAIスクリプト内で使用できますが、本来の関数よりも機能が制限されています。
</p>
<ul>
<li>dofile</li>
<li>loadfile</li>
<li>io.open</li>
</ul>


<p>これらはいずれも指定できるファイルパスが制限されています。
これらの関数に渡すファイルパスfilenameは</p>

<pre>string.match(filename, '^[%w_%-]+%.%w+$')</pre>

<p>にマッチしなければいけません。マッチしない場合はファイルオープンに失敗するなどのエラーが発生します。

</p>
<p>以下のfilenameはマッチします。
</p>
<ul>
<li>hoge-fuga_foo.bar</li>
<li>20140401-log.1</li>
</ul>


<p>以下のfilenameはマッチしません。
</p>
<ul>
<li>./file.txt</li>
<li>dir/foo.txt</li>
<li>bar</li>
</ul>


<p>なお、これらの関数で指定したファイルパスはAIスクリプトのある場所からの相対パスとして解釈されます。
したがって、これらの関数はAIスクリプトのあるフォルダ内のファイルへのみアクセスできます。

</p>
<p>また、dofileおよびloadfileでバイトコードをロードすることはできません。
</p>
<h2>API</h2>

<p>花映塚のゲーム情報を取得したり、キー入力を送信するための関数やオブジェクトがAIスクリプトへ提供されます。
</p>
<p>提供されるものとしては以下のものがあります。
</p>
<ul>
<li>関数
<ul>
<li><a href="#sendKeys">sendKeys</a></li>
<li>hitTest</li>
</ul></li>
<li>グローバル変数
<ul>
<li>game_sides</li>
<li>player_side</li>
<li>difficulty</li>
<li>round</li>
</ul></li>
<li>定数群
<ul>
<li>ExAttackType.*</li>
<li>ItemType.*</li>
<li>HitType.*</li>
<li>CharacterType.*</li>
</ul></li>
</ul>


<h3> 関数</h3>


<p><span id="sendKeys">sendKeys</span>(key_state)
</p>
<p>現在プレイしている自機に対するキー入力を花映塚へ送ります。
key_stateには整数値を指定し、各ビットがそれぞれどのキーを押すかを表します。

</p>
<p>最下位ビットからそれぞれ</p>
<ul>
<li>1bit目: Zキー(射撃)</li>
<li>2bit目: Xキー(緊急ボム)</li>
<li>3bit目: Shiftキー(低速)</li>
<li>4bit目: 未使用</li>
<li>5bit目: ↑キー(上移動)</li>
<li>6bit目: ↓キー(下移動)</li>
<li>7bit目: ←キー(左移動)</li>
<li>8bit目: →キー(右移動)</li>
</ul>
となっています。

</p>
<h3> オブジェクト</h3>


<p>GameSide
Player

Enemy

Bullet

ExAttack

Item

</p>
<h3> 定数群</h3>


<h2>雑多</h2>

  </body>
</html>

